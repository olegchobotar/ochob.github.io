(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[32647],{32647:(t,e,s)=>{"use strict";s.d(e,{EthereumProvider:()=>tk,OPTIONAL_EVENTS:()=>tD,OPTIONAL_METHODS:()=>tH});var i=s(60429),r=s.n(i),n=s(32873),a=s(67216),o=s(18940),h=s(49113),c=s(95647),l=s.n(c),p=s(54932),d=s(35169),u=Object.defineProperty,f=Object.defineProperties,m=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,y=(t,e,s)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,w=(t,e)=>{for(var s in e||(e={}))g.call(e,s)&&y(t,s,e[s]);if(v)for(var s of v(e))P.call(e,s)&&y(t,s,e[s]);return t},b=(t,e)=>f(t,m(e));let C={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};class I{constructor(t,e=!1){if(this.url=t,this.disableProviderPing=e,this.events=new i.EventEmitter,this.isAvailable=!1,this.registering=!1,!(0,d.isHttpUrl)(t))throw Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{let e=(0,p.h)(t),s=await (await l()(this.url,b(w({},C),{body:e}))).json();this.onPayload({data:s})}catch(e){this.onError(t.id,e)}}async register(t=this.url){if(!(0,d.isHttpUrl)(t))throw Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){let t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((t,e)=>{this.events.once("register_error",t=>{this.resetMaxListeners(),e(t)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return e(Error("HTTP connection is missing or invalid"));t()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){let e=(0,p.h)({id:1,jsonrpc:"2.0",method:"test",params:[]});await l()(t,b(w({},C),{body:e}))}this.onOpen()}catch(e){let t=this.parseError(e);throw this.events.emit("register_error",t),this.onClose(),t}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;let e="string"==typeof t.data?(0,p.j)(t.data):t.data;this.events.emit("payload",e)}onError(t,e){let s=this.parseError(e),i=s.message||s.toString(),r=(0,d.formatJsonRpcError)(t,i);this.events.emit("payload",r)}parseError(t,e=this.url){return(0,d.parseConnectionError)(t,e,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}}var E=s(48361);let A="error",O="wc@2:universal_provider:",_="https://rpc.walletconnect.org/v1/",H="generic",$=`${_}bundler`,D={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var q=Object.defineProperty,j=Object.defineProperties,S=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,M=(t,e,s)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,U=(t,e)=>{for(var s in e||(e={}))T.call(e,s)&&M(t,s,e[s]);if(N)for(var s of N(e))R.call(e,s)&&M(t,s,e[s]);return t},x=(t,e)=>j(t,S(e));function F(t,e,s){var i;let r=(0,n._Yb)(t);return(null==(i=e.rpcMap)?void 0:i[r.reference])||`${_}?chainId=${r.namespace}:${r.reference}&projectId=${s}`}function L(t){return t.includes(":")?t.split(":")[1]:t}function B(t){return t.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function k(t={},e={}){let s=G(t),i=G(e);return(0,h.merge)(s,i)}function G(t){var e,s,i,r;let a={};if(!(0,n.aF0)(t))return a;for(let[o,h]of Object.entries(t)){let t=(0,n.nWe)(o)?[o]:h.chains,c=h.methods||[],l=h.events||[],p=h.rpcMap||{},d=(0,n.kob)(o);a[d]=x(U(U({},a[d]),h),{chains:(0,n.TRk)(t,null==(e=a[d])?void 0:e.chains),methods:(0,n.TRk)(c,null==(s=a[d])?void 0:s.methods),events:(0,n.TRk)(l,null==(i=a[d])?void 0:i.events),rpcMap:U(U({},p),null==(r=a[d])?void 0:r.rpcMap)})}return a}function z(t){return t.includes(":")?t.split(":")[2]:t}function J(t){let e={};for(let[s,i]of Object.entries(t)){let t=i.methods||[],r=i.events||[],a=i.accounts||[],o=(0,n.nWe)(s)?[s]:i.chains?i.chains:B(i.accounts);e[s]={chains:o,methods:t,events:r,accounts:a}}return e}function Q(t){return"number"==typeof t?t:t.includes("0x")?parseInt(t,16):isNaN(Number(t=t.includes(":")?t.split(":")[1]:t))?t:Number(t)}let W={},Y=t=>W[t],V=(t,e)=>{W[t]=e};class K{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){let t=this.namespace.accounts;return t&&t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{var s;let i=L(e);t[i]=this.createHttpProvider(i,null==(s=this.namespace.rpcMap)?void 0:s[e])}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace,this.client.core.projectId);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);return new E.F(new I(s,Y("disableProviderPing")))}}var Z=Object.defineProperty,X=Object.defineProperties,tt=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,ts=Object.prototype.hasOwnProperty,ti=Object.prototype.propertyIsEnumerable,tr=(t,e,s)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,tn=(t,e)=>{for(var s in e||(e={}))ts.call(e,s)&&tr(t,s,e[s]);if(te)for(var s of te(e))ti.call(e,s)&&tr(t,s,e[s]);return t},ta=(t,e)=>X(t,tt(e));class to{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(t);case"wallet_getCallsStatus":return await this.getCallStatus(t)}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(parseInt(t),e),this.chainId=parseInt(t),this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,e){let s=e||F(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);return new E.F(new I(s,Y("disableProviderPing")))}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{var s;let i=parseInt(L(e));t[i]=this.createHttpProvider(i,null==(s=this.namespace.rpcMap)?void 0:s[e])}),t}getAccounts(){let t=this.namespace.accounts;return t?[...new Set(t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){let t=this.chainId,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}async handleSwitchChain(t){var e,s;let i=t.request.params?null==(e=t.request.params[0])?void 0:e.chainId:"0x0",r=parseInt(i=i.startsWith("0x")?i:`0x${i}`,16);if(this.isChainApproved(r))this.setDefaultChain(`${r}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:i}]},chainId:null==(s=this.namespace.chains)?void 0:s[0]}),this.setDefaultChain(`${r}`);else throw Error(`Failed to switch to chain 'eip155:${r}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}async getCapabilities(t){var e,s,i;let r=null==(s=null==(e=t.request)?void 0:e.params)?void 0:s[0];if(!r)throw Error("Missing address parameter in `wallet_getCapabilities` request");let n=this.client.session.get(t.topic),a=(null==(i=n?.sessionProperties)?void 0:i.capabilities)||{};if(null!=a&&a[r])return a?.[r];let o=await this.client.request(t);try{await this.client.session.update(t.topic,{sessionProperties:ta(tn({},n.sessionProperties||{}),{capabilities:ta(tn({},a||{}),{[r]:o})})})}catch(t){console.warn("Failed to update session with capabilities",t)}return o}async getCallStatus(t){var e,s;let i=this.client.session.get(t.topic),r=null==(e=i.sessionProperties)?void 0:e.bundler_name;if(r){let e=this.getBundlerUrl(t.chainId,r);try{return await this.getUserOperationReceipt(e,t)}catch(t){console.warn("Failed to fetch call status from bundler",t,e)}}let n=null==(s=i.sessionProperties)?void 0:s.bundler_url;if(n)try{return await this.getUserOperationReceipt(n,t)}catch(t){console.warn("Failed to fetch call status from custom bundler",t,n)}if(this.namespace.methods.includes(t.request.method))return await this.client.request(t);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(t,e){var s;let i=new URL(t),r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,d.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(s=e.request.params)?void 0:s[0]]))});if(!r.ok)throw Error(`Failed to fetch user operation receipt - ${r.status}`);return await r.json()}getBundlerUrl(t,e){return`${$}?projectId=${this.client.core.projectId}&chainId=${t}&bundler=${e}`}}class th{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}getAccounts(){let t=this.namespace.accounts;return t?[...new Set(t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{var s;let i=L(e);t[i]=this.createHttpProvider(i,null==(s=this.namespace.rpcMap)?void 0:s[e])}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace,this.client.core.projectId);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);return new E.F(new I(s,Y("disableProviderPing")))}}class tc{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let t=this.namespace.accounts;return t?[...new Set(t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{var s;let i=L(e);t[i]=this.createHttpProvider(i,null==(s=this.namespace.rpcMap)?void 0:s[e])}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace,this.client.core.projectId);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);return new E.F(new I(s,Y("disableProviderPing")))}}class tl{constructor(t){this.name="algorand",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(!this.httpProviders[t]){let s=e||F(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}getAccounts(){let t=this.namespace.accounts;return t?[...new Set(t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{var s;t[e]=this.createHttpProvider(e,null==(s=this.namespace.rpcMap)?void 0:s[e])}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new E.F(new I(s,Y("disableProviderPing")))}}class tp{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let t=this.namespace.accounts;return t?[...new Set(t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{let s=this.getCardanoRPCUrl(e),i=L(e);t[i]=this.createHttpProvider(i,s)}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}getCardanoRPCUrl(t){let e=this.namespace.rpcMap;if(e)return e[t]}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||this.getCardanoRPCUrl(t);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);return new E.F(new I(s,Y("disableProviderPing")))}}class td{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}getAccounts(){let t=this.namespace.accounts;return t?[...new Set(t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{var s;let i=L(e);t[i]=this.createHttpProvider(i,null==(s=this.namespace.rpcMap)?void 0:s[e])}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace,this.client.core.projectId);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);return new E.F(new I(s,Y("disableProviderPing")))}}class tu{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}getAccounts(){let t=this.namespace.accounts;return t?[...new Set(t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{var s;let i=L(e);t[i]=this.createHttpProvider(i,null==(s=this.namespace.rpcMap)?void 0:s[e])}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace,this.client.core.projectId);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);return new E.F(new I(s,Y("disableProviderPing")))}}class tf{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(this.chainId=t,!this.httpProviders[t]){let s=e||F(`${this.name}:${t}`,this.namespace);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let t=this.namespace.accounts;return t&&t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{var s;t[e]=this.createHttpProvider(e,null==(s=this.namespace.rpcMap)?void 0:s[e])}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace);return typeof s>"u"?void 0:new E.F(new I(s,Y("disableProviderPing")))}}class tm{constructor(t){this.name="tezos",this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(this.chainId=t,!this.httpProviders[t]){let s=e||F(`${this.name}:${t}`,this.namespace);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let t=this.namespace.accounts;return t&&t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){let t={};return this.namespace.chains.forEach(e=>{t[e]=this.createHttpProvider(e)}),t}getHttpProvider(){let t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace);return typeof s>"u"?void 0:new E.F(new I(s))}}class tv{constructor(t){this.name=H,this.namespace=t.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(t.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(t.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(t.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(t.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider(t.chainId).request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(D.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let t=this.namespace.chains[0];if(!t)throw Error("ChainId not found");return t.split(":")[1]}getAccounts(){let t=this.namespace.accounts;return t?[...new Set(t.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var t,e;let s={};return null==(e=null==(t=this.namespace)?void 0:t.accounts)||e.forEach(t=>{let e=(0,n._Yb)(t);s[`${e.namespace}:${e.reference}`]=this.createHttpProvider(t)}),s}getHttpProvider(t){let e=this.httpProviders[t];if(typeof e>"u")throw Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){let s=this.createHttpProvider(t,e);s&&(this.httpProviders[t]=s)}createHttpProvider(t,e){let s=e||F(t,this.namespace,this.client.core.projectId);if(!s)throw Error(`No RPC url provided for chainId: ${t}`);return new E.F(new I(s,Y("disableProviderPing")))}}var tg=Object.defineProperty,tP=Object.defineProperties,ty=Object.getOwnPropertyDescriptors,tw=Object.getOwnPropertySymbols,tb=Object.prototype.hasOwnProperty,tC=Object.prototype.propertyIsEnumerable,tI=(t,e,s)=>e in t?tg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,tE=(t,e)=>{for(var s in e||(e={}))tb.call(e,s)&&tI(t,s,e[s]);if(tw)for(var s of tw(e))tC.call(e,s)&&tI(t,s,e[s]);return t},tA=(t,e)=>tP(t,ty(e));class tO{constructor(t){this.events=new(r()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger="u">typeof t?.logger&&"string"!=typeof t?.logger?t.logger:(0,o.h6)((0,o.iP)({level:t?.logger||A})),this.disableProviderPing=t?.disableProviderPing||!1}static async init(t){let e=new tO(t);return await e.initialize(),e}async request(t,e,s){let[i,r]=this.validateChain(e);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(i).request({request:tE({},t),chainId:`${i}:${r}`,topic:this.session.topic,expiry:s})}sendAsync(t,e,s,i){let r=new Date().getTime();this.request(t,s,i).then(t=>e(null,(0,d.formatJsonRpcResult)(r,t))).catch(t=>e(t,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(t=this.session)?void 0:t.topic,reason:(0,n.Hjj)("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}async authenticate(t,e){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(t),await this.cleanupPendingPairings();let{uri:s,response:i}=await this.client.authenticate(t,e);s&&(this.uri=s,this.events.emit("display_uri",s));let r=await i();if(this.session=r.session,this.session){let t=J(this.session.namespaces);this.namespaces=k(this.namespaces,t),this.persist("namespaces",this.namespaces),this.onConnect()}return r}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}removeListener(t,e){this.events.removeListener(t,e)}off(t,e){this.events.off(t,e)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let e=0;do{if(this.shouldAbortPairingAttempt)throw Error("Pairing aborted");if(e>=this.maxPairingAttempts)throw Error("Max auto pairing attempts reached");let{uri:s,approval:i}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await i().then(t=>{this.session=t;let e=J(t.namespaces);this.namespaces=k(this.namespaces,e),this.persist("namespaces",this.namespaces)}).catch(t=>{if(t.message!==a.L6)throw t;e++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,e){try{if(!this.session)return;let[s,i]=this.validateChain(t),r=this.getProvider(s);r.name===H?r.setDefaultChain(`${s}:${i}`,e):r.setDefaultChain(i,e)}catch(t){if(!/Please call connect/.test(t.message))throw t}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");let e=this.client.pairing.getAll();if((0,n.OP1)(e)){for(let s of e)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${e.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){let t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await a.Ay.init({core:this.providerOpts.core,logger:this.providerOpts.logger||A,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let t=[...new Set(Object.keys(this.session.namespaces).map(t=>(0,n.kob)(t)))];V("client",this.client),V("events",this.events),V("disableProviderPing",this.disableProviderPing),t.forEach(t=>{if(!this.session)return;let e=function(t,e){let s=Object.keys(e.namespaces).filter(e=>e.includes(t));if(!s.length)return[];let i=[];return s.forEach(t=>{let s=e.namespaces[t].accounts;i.push(...s)}),i}(t,this.session),s=B(e),i=tA(tE({},k(this.namespaces,this.optionalNamespaces)[t]),{accounts:e,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new to({namespace:i});break;case"algorand":this.rpcProviders[t]=new tl({namespace:i});break;case"solana":this.rpcProviders[t]=new th({namespace:i});break;case"cosmos":this.rpcProviders[t]=new tc({namespace:i});break;case"polkadot":this.rpcProviders[t]=new K({namespace:i});break;case"cip34":this.rpcProviders[t]=new tp({namespace:i});break;case"elrond":this.rpcProviders[t]=new td({namespace:i});break;case"multiversx":this.rpcProviders[t]=new tu({namespace:i});break;case"near":this.rpcProviders[t]=new tf({namespace:i});break;case"tezos":this.rpcProviders[t]=new tm({namespace:i});break;default:this.rpcProviders[H]?this.rpcProviders[H].updateNamespace(i):this.rpcProviders[H]=new tv({namespace:i})}})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{let{params:e}=t,{event:s}=e;if("accountsChanged"===s.name){let t=s.data;t&&(0,n.OP1)(t)&&this.events.emit("accountsChanged",t.map(z))}else if("chainChanged"===s.name){let t=e.chainId,s=e.event.data,i=(0,n.kob)(t),r=Q(t)!==Q(s)?`${i}:${Q(s)}`:t;this.onChainChanged(r)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:e})=>{var s;let{namespaces:i}=e,r=null==(s=this.client)?void 0:s.session.get(t);this.session=tA(tE({},r),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:e})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",tA(tE({},(0,n.Hjj)("USER_DISCONNECTED")),{data:t.topic}))}),this.on(D.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){return this.rpcProviders[t]||this.rpcProviders[H]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var e;this.getProvider(t).updateNamespace(null==(e=this.session)?void 0:e.namespaces[t])})}setNamespaces(t){let{namespaces:e,optionalNamespaces:s,sessionProperties:i}=t;e&&Object.keys(e).length&&(this.namespaces=e),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=i,this.persist("namespaces",e),this.persist("optionalNamespaces",s)}validateChain(t){let[e,s]=t?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[e,s];if(e&&!Object.keys(this.namespaces||{}).map(t=>(0,n.kob)(t)).includes(e))throw Error(`Namespace '${e}' is not configured. Please call connect() first with namespace config.`);if(e&&s)return[e,s];let i=(0,n.kob)(Object.keys(this.namespaces)[0]),r=this.rpcProviders[i].getDefaultChain();return[i,r]}async requestAccounts(){let[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,e=!1){if(!this.namespaces)return;let[s,i]=this.validateChain(t);i&&(e||this.getProvider(s).setDefaultChain(i),this.namespaces[s]?this.namespaces[s].defaultChain=i:this.namespaces[`${s}:${i}`]?this.namespaces[`${s}:${i}`].defaultChain=i:this.namespaces[`${s}:${i}`]={defaultChain:i},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",i))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,e){this.client.core.storage.setItem(`${O}/${t}`,e)}async getFromStore(t){return await this.client.core.storage.getItem(`${O}/${t}`)}}let t_=["eth_sendTransaction","personal_sign"],tH=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],t$=["chainChanged","accountsChanged"],tD=["chainChanged","accountsChanged","message","disconnect","connect"];var tq=Object.defineProperty,tj=Object.defineProperties,tS=Object.getOwnPropertyDescriptors,tN=Object.getOwnPropertySymbols,tT=Object.prototype.hasOwnProperty,tR=Object.prototype.propertyIsEnumerable,tM=(t,e,s)=>e in t?tq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,tU=(t,e)=>{for(var s in e||(e={}))tT.call(e,s)&&tM(t,s,e[s]);if(tN)for(var s of tN(e))tR.call(e,s)&&tM(t,s,e[s]);return t},tx=(t,e)=>tj(t,tS(e));function tF(t){return Number(t[0].split(":")[1])}function tL(t){return`0x${t.toString(16)}`}class tB{constructor(){this.events=new i.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY="wc@2:ethereum_provider:",this.on=(t,e)=>(this.events.on(t,e),this),this.once=(t,e)=>(this.events.once(t,e),this),this.removeListener=(t,e)=>(this.events.removeListener(t,e),this),this.off=(t,e)=>(this.events.off(t,e),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){let e=new tB;return await e.initialize(t),e}async request(t,e){return await this.signer.request(t,this.formatChainId(this.chainId),e)}sendAsync(t,e,s){this.signer.sendAsync(t,e,this.formatChainId(this.chainId),s)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);let{required:e,optional:s}=function(t){let{chains:e,optionalChains:s,methods:i,optionalMethods:r,events:a,optionalEvents:o,rpcMap:h}=t;if(!(0,n.OP1)(e))throw Error("Invalid chains");let c={chains:e,methods:i||t_,events:a||t$,rpcMap:tU({},e.length?{[tF(e)]:h[tF(e)]}:{})},l=a?.filter(t=>!t$.includes(t)),p=i?.filter(t=>!t_.includes(t));if(!s&&!o&&!r&&!(null!=l&&l.length)&&!(null!=p&&p.length))return{required:e.length?c:void 0};let d={chains:[...new Set(l?.length&&p?.length||!s?c.chains.concat(s||[]):s)],methods:[...new Set(c.methods.concat(null!=r&&r.length?r:tH))],events:[...new Set(c.events.concat(null!=o&&o.length?o:tD))],rpcMap:h};return{required:e.length?c:void 0,optional:s.length?d:void 0}}(this.rpc);try{let i=await new Promise(async(i,r)=>{var n;this.rpc.showQrModal&&(null==(n=this.modal)||n.subscribeModal(t=>{t.open||this.signer.session||(this.signer.abortPairingAttempt(),r(Error("Connection request reset. Please try again.")))})),await this.signer.connect(tx(tU({namespaces:tU({},e&&{[this.namespace]:e})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t?.pairingTopic})).then(t=>{i(t)}).catch(t=>{r(Error(t.message))})});if(!i)return;let r=(0,n.Zz7)(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:r),this.setAccounts(r),this.events.emit("connect",{chainId:tL(this.chainId)})}catch(t){throw this.signer.logger.error(t),t}finally{this.modal&&this.modal.closeModal()}}async authenticate(t,e){if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:t?.chains});try{let s=await new Promise(async(s,i)=>{var r;this.rpc.showQrModal&&(null==(r=this.modal)||r.subscribeModal(t=>{t.open||this.signer.session||(this.signer.abortPairingAttempt(),i(Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(tx(tU({},t),{chains:this.rpc.chains}),e).then(t=>{s(t)}).catch(t=>{i(Error(t.message))})}),i=s.session;if(i){let t=(0,n.Zz7)(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:t),this.setAccounts(t),this.events.emit("connect",{chainId:tL(this.chainId)})}return s}catch(t){throw this.signer.logger.error(t),t}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{let{params:e}=t,{event:s}=e;"accountsChanged"===s.name?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===s.name?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{let e=parseInt(t);this.chainId=e,this.events.emit("chainChanged",tL(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",tx(tU({},(0,n.Hjj)("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var e,s;this.rpc.showQrModal&&(null==(e=this.modal)||e.closeModal(),null==(s=this.modal)||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return"string"==typeof t&&t.startsWith(`${this.namespace}:`)}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){let e=t.filter(t=>this.isCompatibleChainId(t)).map(t=>this.parseChainId(t));e.length&&(this.chainId=e[0],this.events.emit("chainChanged",tL(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){let e=this.parseChainId(t);this.chainId=e,this.switchEthereumChain(e)}}parseAccountId(t){let[e,s,i]=t.split(":");return{chainId:`${e}:${s}`,address:i}}setAccounts(t){this.accounts=t.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var e,s;let i=null!=(e=t?.chains)?e:[],r=null!=(s=t?.optionalChains)?s:[],n=i.concat(r);if(!n.length)throw Error("No chains specified in either `chains` or `optionalChains`");let a=i.length?t?.methods||t_:[],o=i.length?t?.events||t$:[],h=t?.optionalMethods||[],c=t?.optionalEvents||[],l=t?.rpcMap||this.buildRpcMap(n,t.projectId),p=t?.qrModalOptions||void 0;return{chains:i?.map(t=>this.formatChainId(t)),optionalChains:r.map(t=>this.formatChainId(t)),methods:a,events:o,optionalMethods:h,optionalEvents:c,rpcMap:l,showQrModal:!!(null!=t&&t.showQrModal),qrModalOptions:p,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,e){let s={};return t.forEach(t=>{s[t]=this.getRpcUrl(t,e)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?tF(this.rpc.chains):tF(this.rpc.optionalChains),this.signer=await tO.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions,customStoragePrefix:t.customStoragePrefix,telemetryEnabled:t.telemetryEnabled,logger:t.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{let{WalletConnectModal:e}=await s.e(89099).then(s.bind(s,89099));t=e}catch{throw Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(tU({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(t){throw this.signer.logger.error(t),Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;let{chains:e,optionalChains:s,rpcMap:i}=t;e&&(0,n.OP1)(e)&&(this.rpc.chains=e.map(t=>this.formatChainId(t)),e.forEach(t=>{this.rpc.rpcMap[t]=i?.[t]||this.getRpcUrl(t)})),s&&(0,n.OP1)(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s?.map(t=>this.formatChainId(t)),s.forEach(t=>{this.rpc.rpcMap[t]=i?.[t]||this.getRpcUrl(t)}))}getRpcUrl(t,e){var s;return(null==(s=this.rpc.rpcMap)?void 0:s[t])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${t}&projectId=${e||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{let t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),e=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:e?.accounts),this.setAccounts(e?.accounts)}catch(t){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(t),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return"string"==typeof t||t instanceof String?[this.parseAccount(t)]:t.map(t=>this.parseAccount(t))}}let tk=tB},95647:(t,e,s)=>{var i="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==s.g&&s.g,r=function(){function t(){this.fetch=!1,this.DOMException=i.DOMException}return t.prototype=i,new t}();!function(t){!function(e){var i=void 0!==t&&t||"undefined"!=typeof self&&self||void 0!==s.g&&s.g||{},r={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};if(r.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1};function o(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function h(t){return"string"!=typeof t&&(t=String(t)),t}function c(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return r.iterable&&(e[Symbol.iterator]=function(){return e}),e}function l(t){this.map={},t instanceof l?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){if(2!=t.length)throw TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function p(t){if(!t._noBody){if(t.bodyUsed)return Promise.reject(TypeError("Already read"));t.bodyUsed=!0}}function d(t){return new Promise(function(e,s){t.onload=function(){e(t.result)},t.onerror=function(){s(t.error)}})}function u(t){var e=new FileReader,s=d(e);return e.readAsArrayBuffer(t),s}function f(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(t){if(this.bodyUsed=this.bodyUsed,this._bodyInit=t,t){if("string"==typeof t)this._bodyText=t;else if(r.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(r.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else{var e;r.arrayBuffer&&r.blob&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=f(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||a(t))?this._bodyArrayBuffer=f(t):this._bodyText=t=Object.prototype.toString.call(t)}}else this._noBody=!0,this._bodyText="";!this.headers.get("content-type")&&("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(!this._bodyFormData)return Promise.resolve(new Blob([this._bodyText]));throw Error("could not read FormData body as blob")}),this.arrayBuffer=function(){if(this._bodyArrayBuffer)return p(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer));if(r.blob)return this.blob().then(u);throw Error("could not read as ArrayBuffer")},this.text=function(){var t,e,s,i,r,n=p(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,s=d(e=new FileReader),r=(i=/charset=([A-Za-z0-9_-]+)/.exec(t.type))?i[1]:"utf-8",e.readAsText(t,r),s;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),s=Array(e.length),i=0;i<e.length;i++)s[i]=String.fromCharCode(e[i]);return s.join("")}(this._bodyArrayBuffer));if(!this._bodyFormData)return Promise.resolve(this._bodyText);throw Error("could not read FormData body as text")},r.formData&&(this.formData=function(){return this.text().then(P)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(t,e){t=o(t),e=h(e);var s=this.map[t];this.map[t]=s?s+", "+e:e},l.prototype.delete=function(t){delete this.map[o(t)]},l.prototype.get=function(t){return t=o(t),this.has(t)?this.map[t]:null},l.prototype.has=function(t){return this.map.hasOwnProperty(o(t))},l.prototype.set=function(t,e){this.map[o(t)]=h(e)},l.prototype.forEach=function(t,e){for(var s in this.map)this.map.hasOwnProperty(s)&&t.call(e,this.map[s],s,this)},l.prototype.keys=function(){var t=[];return this.forEach(function(e,s){t.push(s)}),c(t)},l.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),c(t)},l.prototype.entries=function(){var t=[];return this.forEach(function(e,s){t.push([s,e])}),c(t)},r.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var v=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function g(t,e){if(!(this instanceof g))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var s,r,n=(e=e||{}).body;if(t instanceof g){if(t.bodyUsed)throw TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new l(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new l(e.headers)),this.method=(r=(s=e.method||this.method||"GET").toUpperCase(),v.indexOf(r)>-1?r:s),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in i)return new AbortController().signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),("GET"===this.method||"HEAD"===this.method)&&("no-store"===e.cache||"no-cache"===e.cache)){var a=/([?&])_=[^&]*/;a.test(this.url)?this.url=this.url.replace(a,"$1_="+new Date().getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+new Date().getTime()}}function P(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var s=t.split("="),i=s.shift().replace(/\+/g," "),r=s.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(r))}}),e}function y(t,e){if(!(this instanceof y))throw TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.status<200||this.status>599)throw RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===e.statusText?"":""+e.statusText,this.headers=new l(e.headers),this.url=e.url||"",this._initBody(t)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},m.call(g.prototype),m.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},y.error=function(){var t=new y(null,{status:200,statusText:""});return t.ok=!1,t.status=0,t.type="error",t};var w=[301,302,303,307,308];y.redirect=function(t,e){if(-1===w.indexOf(e))throw RangeError("Invalid status code");return new y(null,{status:e,headers:{location:t}})},e.DOMException=i.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var s=Error(t);this.stack=s.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function b(t,s){return new Promise(function(n,a){var c=new g(t,s);if(c.signal&&c.signal.aborted)return a(new e.DOMException("Aborted","AbortError"));var p=new XMLHttpRequest;function d(){p.abort()}if(p.onload=function(){var t,e,s={statusText:p.statusText,headers:(t=p.getAllResponseHeaders()||"",e=new l,t.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(t){return 0===t.indexOf("\n")?t.substr(1,t.length):t}).forEach(function(t){var s=t.split(":"),i=s.shift().trim();if(i){var r=s.join(":").trim();try{e.append(i,r)}catch(t){console.warn("Response "+t.message)}}}),e)};0===c.url.indexOf("file://")&&(p.status<200||p.status>599)?s.status=200:s.status=p.status,s.url="responseURL"in p?p.responseURL:s.headers.get("X-Request-URL");var i="response"in p?p.response:p.responseText;setTimeout(function(){n(new y(i,s))},0)},p.onerror=function(){setTimeout(function(){a(TypeError("Network request failed"))},0)},p.ontimeout=function(){setTimeout(function(){a(TypeError("Network request timed out"))},0)},p.onabort=function(){setTimeout(function(){a(new e.DOMException("Aborted","AbortError"))},0)},p.open(c.method,function(t){try{return""===t&&i.location.href?i.location.href:t}catch(e){return t}}(c.url),!0),"include"===c.credentials?p.withCredentials=!0:"omit"===c.credentials&&(p.withCredentials=!1),"responseType"in p&&(r.blob?p.responseType="blob":r.arrayBuffer&&(p.responseType="arraybuffer")),s&&"object"==typeof s.headers&&!(s.headers instanceof l||i.Headers&&s.headers instanceof i.Headers)){var u=[];Object.getOwnPropertyNames(s.headers).forEach(function(t){u.push(o(t)),p.setRequestHeader(t,h(s.headers[t]))}),c.headers.forEach(function(t,e){-1===u.indexOf(e)&&p.setRequestHeader(e,t)})}else c.headers.forEach(function(t,e){p.setRequestHeader(e,t)});c.signal&&(c.signal.addEventListener("abort",d),p.onreadystatechange=function(){4===p.readyState&&c.signal.removeEventListener("abort",d)}),p.send(void 0===c._bodyInit?null:c._bodyInit)})}b.polyfill=!0,i.fetch||(i.fetch=b,i.Headers=l,i.Request=g,i.Response=y),e.Headers=l,e.Request=g,e.Response=y,e.fetch=b,Object.defineProperty(e,"__esModule",{value:!0})}({})}(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var n=i.fetch?i:r;(e=n.fetch).default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e}}]);