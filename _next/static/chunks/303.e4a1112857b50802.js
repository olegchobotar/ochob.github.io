"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[303,28750],{28750:(e,t,a)=>{a.r(t),a.d(t,{signLoginPayload:()=>i});async function i(e){let{payload:t,account:a}=e;return{signature:await a.signMessage({message:function(e){let t=[`${e.domain} wants you to sign in with your Ethereum account:`,e.address].join("\n");t=[t,e.statement].join("\n\n"),e.statement&&(t+="\n");let a=[];if(e.uri){let t=`URI: ${e.uri}`;a.push(t)}let i=`Version: ${e.version}`;if(a.push(i),e.chain_id){let t=`Chain ID: ${e.chain_id}`||"1";a.push(t)}let n=`Nonce: ${e.nonce}`;a.push(n);let s=`Issued At: ${e.issued_at}`;a.push(s);let r=`Expiration Time: ${e.expiration_time}`;if(a.push(r),e.invalid_before){let t=`Not Before: ${e.invalid_before}`;a.push(t)}return e.resources&&a.push(["Resources:",...e.resources.map(e=>`- ${e}`)].join("\n")),[t,a.join("\n")].join("\n")}(t)}),payload:t}}},23779:(e,t,a)=>{a.d(t,{B:()=>i});async function i(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}},303:(e,t,a)=>{a.r(t),a.d(t,{InAppWebConnector:()=>ei});var i=a(37150),n=a(35408),s=a(25007);async function r({authToken:e,client:t,ecosystem:a}){let n=(0,s.KI)(t,a),r=await n(`${(0,i.Wg)("inAppWallet")}/api/2024-05-05/accounts`,{method:"GET",headers:{"Content-Type":"application/json","x-thirdweb-client-id":t.clientId,Authorization:`Bearer embedded-wallet-token:${e}`}});if(!r.ok){if(401===r.status)return;let e=await r.json();throw Error(`Failed to get user status: ${e.message}`)}return await r.json()}var o=a(94271);let l=(0,i.Wg)("inAppWallet"),c=`${l}/`,d=`${c}api/2023-10-20`,h=`${d}/embedded-wallet/validate-custom-jwt`,u=`${d}/embedded-wallet/validate-custom-auth-endpoint`,g=(e,t)=>t instanceof Error?`${e}: ${t.message}`:`${e}: ${(0,o.A)(t)}`;async function p(e){let t=(0,s.KI)(e.client,e.ecosystem),a=await t(u,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,o.A)({payload:e.payload,developerClientId:e.client.clientId})});if(!a.ok){let e=await a.json();throw Error(`Custom auth endpoint authentication error: ${e.message}`)}try{let{verifiedToken:e}=await a.json();return{storedToken:e}}catch(e){throw Error(g("Malformed response from post auth_endpoint authentication",e))}}var m=a(95001);async function w(e){let t=(0,s.KI)(e.client,e.ecosystem),a=(0,m.f)({authOption:"backend",client:e.client,ecosystem:e.ecosystem}),i=await t(`${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,o.A)({walletSecret:e.walletSecret})});if(!i.ok)throw Error("Failed to generate backend account");return await i.json()}var y=a(92767),f=a(86750);async function b(e){let t=new y.t({storage:e.storage,clientId:e.client.clientId,ecosystem:e.ecosystem}),a=await t.getGuestSessionId();a||(a=(0,f.O)(32),t.saveGuestSessionId(a));let i=(0,s.KI)(e.client,e.ecosystem),n=(0,m.K)({authOption:"guest",client:e.client,ecosystem:e.ecosystem}),r=await i(`${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,o.A)({sessionId:a})});if(!r.ok)throw Error("Failed to generate guest account");return await r.json()}async function v(e){let t=(0,s.KI)(e.client,e.ecosystem),a=await t(h,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,o.A)({jwt:e.jwt,developerClientId:e.client.clientId})});if(!a.ok){let e=await a.json();throw Error(`JWT authentication error: ${e.message}`)}try{let{verifiedToken:e}=await a.json();return{storedToken:e}}catch(e){throw Error(g("Malformed response from post jwt authentication",e))}}async function I({client:e,ecosystem:t,tokenToLink:a,storage:n}){let r=(0,s.KI)(e,t),l=(0,i.Wg)("inAppWallet"),c=await n.getAuthCookie();if(!c)throw Error("Failed to link account, no user logged in");let d={Authorization:`Bearer iaw-auth-token:${c}`,"Content-Type":"application/json"},h=await r(`${l}/api/2024-05-05/account/connect`,{method:"POST",headers:d,body:(0,o.A)({accountAuthTokenToConnect:a})});if(!h.ok)throw Error((await h.json()).message||"Failed to link account.");let{linkedAccounts:u}=await h.json();return u??[]}async function k({client:e,ecosystem:t,profileToUnlink:a,storage:n}){let r=(0,s.KI)(e,t),l=(0,i.Wg)("inAppWallet"),c=await n.getAuthCookie();if(!c)throw Error("Failed to unlink account, no user logged in");let d={Authorization:`Bearer iaw-auth-token:${c}`,"Content-Type":"application/json"},h=await r(`${l}/api/2024-05-05/account/disconnect`,{method:"POST",headers:d,body:(0,o.A)(a)});if(!h.ok)throw Error((await h.json()).message||"Failed to unlink account.");let{linkedAccounts:u}=await h.json();return u??[]}async function W({client:e,ecosystem:t,storage:a}){let n=(0,s.KI)(e,t),r=(0,i.Wg)("inAppWallet"),o=await a.getAuthCookie();if(!o)throw Error("Failed to get linked accounts, no user logged in");let l={Authorization:`Bearer iaw-auth-token:${o}`,"Content-Type":"application/json"},c=await n(`${r}/api/2024-05-05/accounts`,{method:"GET",headers:l});if(!c.ok)throw Error((await c.json()).message||"Failed to get linked accounts.");let{linkedAccounts:d}=await c.json();return d??[]}function A(){return`${(0,i.Wg)("inAppWallet")}/api/2024-05-05/login/passkey/callback`}function S(e,t){return`${(0,i.Wg)("inAppWallet")}/api/2024-05-05/login/passkey?type=${e}${t?`&username=${t}`:""}`}async function T(e){var t;if(!e.passkeyClient.isAvailable())throw Error("Passkeys are not available on this device");let a=(0,s.KI)(e.client,e.ecosystem),i=e.username??(t=e.ecosystem,`${t?.id??"wallet"}-${new Date().toISOString()}`),n=await a(S("sign-up",i)),r=await n.json();if(!r.challenge)throw Error("No challenge received");let l=r.challenge,c=await e.passkeyClient.register({name:i,challenge:l,rp:e.rp}),d={};e.ecosystem?.partnerId&&(d["x-ecosystem-partner-id"]=e.ecosystem.partnerId),e.ecosystem?.id&&(d["x-ecosystem-id"]=e.ecosystem.id);let h=await a(A(),{method:"POST",headers:{"Content-Type":"application/json",...d},body:(0,o.A)({type:"sign-up",authenticatorData:c.authenticatorData,credentialId:c.credentialId,serverVerificationId:r.serverVerificationId,clientData:c.clientData,username:i,credential:{publicKey:c.credential.publicKey,algorithm:c.credential.algorithm},origin:c.origin,rpId:e.rp.id})}),u=await h.json();if(!u||!u.storedToken)throw Error(`Error verifying passkey: ${u.message??"unknown error"}`);return await e.storage?.savePasskeyCredentialId(c.credentialId),u}async function j(e){if(!e.passkeyClient.isAvailable())throw Error("Passkeys are not available on this device");let t=(0,s.KI)(e.client,e.ecosystem),[a,i]=await Promise.all([t(S("sign-in")).then(e=>e.json()),e.storage?.getPasskeyCredentialId()]);if(!a.challenge)throw Error("No challenge received");let n=a.challenge,r=await e.passkeyClient.authenticate({credentialId:i??void 0,challenge:n,rp:e.rp}),l={};e.ecosystem?.partnerId&&(l["x-ecosystem-partner-id"]=e.ecosystem.partnerId),e.ecosystem?.id&&(l["x-ecosystem-id"]=e.ecosystem.id);let c=await t(A(),{method:"POST",headers:{"Content-Type":"application/json",...l},body:(0,o.A)({type:"sign-in",authenticatorData:r.authenticatorData,credentialId:r.credentialId,serverVerificationId:a.serverVerificationId,clientData:r.clientData,signature:r.signature,origin:r.origin,rpId:e.rp.id})}),d=await c.json();if(!d||!d.storedToken)throw Error(`Error verifying passkey: ${d.message??"unknown error"}`);return await e.storage?.savePasskeyCredentialId(r.credentialId),d}var P=a(28750);async function L(e){let{wallet:t,chain:a}=e,i=t.getAccount()||await t.connect({client:e.client}),n=(0,s.KI)(e.client,e.ecosystem),r=await (async()=>{let t=(0,m.f)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),s=await n(`${t}&address=${i.address}&chainId=${a.id}`);if(!s.ok)throw Error("Failed to generate SIWE login payload");return await s.json()})(),{signature:l}=await (0,P.signLoginPayload)({payload:r,account:i});return await (async()=>{let t=(0,m.K)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),a=await n(`${t}&signature=${l}&payload=${encodeURIComponent(r)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,o.A)({signature:l,payload:r})});if(!a.ok)throw Error("Failed to verify SIWE signature");return await a.json()})()}var E=a(98979),O=a(60438),C=a(62251),$=a(23779),x=a(9751),D=a(75231),N=a(10354),B=a(7188);async function F({client:e,payload:{message:t,isRaw:a},storage:n}){let r=await n.getAuthCookie(),l=n.ecosystem,c=(0,s.KI)(e,l);if(!r)throw Error("No auth token found when signing message");let d=await c(`${(0,i.Wg)("inAppWallet")}/api/v1/enclave-wallet/sign-message`,{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":e.clientId,Authorization:`Bearer embedded-wallet-token:${r}`},body:(0,o.A)({messagePayload:{message:t,isRaw:a}})});if(!d.ok)throw Error(`Failed to sign message - ${d.status} ${d.statusText}`);return await d.json()}async function M({client:e,payload:t,storage:a}){let n=await a.getAuthCookie(),r=a.ecosystem,l=(0,s.KI)(e,r);if(!n)throw Error("No auth token found when signing transaction");let c=await l(`${(0,i.Wg)("inAppWallet")}/api/v1/enclave-wallet/sign-transaction`,{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":e.clientId,Authorization:`Bearer embedded-wallet-token:${n}`},body:(0,o.A)({transactionPayload:t})});if(!c.ok)throw Error(`Failed to sign transaction - ${c.status} ${c.statusText}`);return(await c.json()).signature}async function U({client:e,payload:t,storage:a}){let n=await a.getAuthCookie(),r=a.ecosystem,l=(0,s.KI)(e,r);if(!n)throw Error("No auth token found when signing typed data");let c=await l(`${(0,i.Wg)("inAppWallet")}/api/v1/enclave-wallet/sign-typed-data`,{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":e.clientId,Authorization:`Bearer embedded-wallet-token:${n}`},body:(0,o.A)({...t})});if(!c.ok)throw Error(`Failed to sign typed data - ${c.status} ${c.statusText}`);return await c.json()}class z{constructor({client:e,ecosystem:t,address:a,storage:i}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"address",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.address=a,this.localStorage=i}async postWalletSetUp(e){await this.localStorage.saveAuthCookie(e.storedToken.cookieString)}async getUserWalletStatus(){let e=await this.localStorage.getAuthCookie();if(!e)return{status:"Logged Out"};let t=await r({authToken:e,client:this.client,ecosystem:this.ecosystem});if(!t)return{status:"Logged Out"};let a=t.wallets[0],i={email:t.linkedAccounts.find(e=>void 0!==e.details.email)?.details.email,phoneNumber:t.linkedAccounts.find(e=>void 0!==e.details.phone)?.details.phone,userWalletId:t.id||"",recoveryShareManagement:"ENCLAVE"};return a?{status:"Logged In, Wallet Initialized",walletAddress:a.address,authDetails:i,account:await this.getAccount()}:{status:"Logged In, Wallet Uninitialized",authDetails:i}}async getAccount(){let e=this.client,t=this.localStorage,i=this.address,n=this.ecosystem,s=async i=>{let n=(0,x.getRpcClient)({client:e,chain:(0,C.Q4)(i.chainId)}),s={to:i.to?(0,D.bv)(i.to):void 0,data:i.data,value:"bigint"==typeof i.value?(0,N.nj)(i.value):void 0,gas:"bigint"==typeof i.gas?(0,N.nj)(i.gas+i.gas/BigInt(10)):void 0,nonce:"number"==typeof i.nonce?(0,N.nj)(i.nonce):(0,N.nj)(await a.e(39142).then(a.bind(a,39142)).then(({eth_getTransactionCount:e})=>e(n,{address:this.address,blockTag:"pending"}))),chainId:(0,N.nj)(i.chainId)};return"bigint"==typeof i.maxFeePerGas?(s.maxFeePerGas=(0,N.nj)(i.maxFeePerGas),s.maxPriorityFeePerGas="bigint"==typeof i.maxPriorityFeePerGas?(0,N.nj)(i.maxPriorityFeePerGas):void 0,s.type=2):(s.gasPrice="bigint"==typeof i.gasPrice?(0,N.nj)(i.gasPrice):void 0,s.type=0),M({client:e,storage:t,payload:s})};return{address:(0,D.bv)(i),async signTransaction(e){if(!e.chainId)throw Error("chainId required in tx to sign");return s({chainId:e.chainId,...e})},async sendTransaction(t){let a=(0,x.getRpcClient)({client:e,chain:(0,C.Q4)(t.chainId)}),r=await s(t),o=await (0,$.B)(a,r);return(0,O.E)({client:e,ecosystem:n,chainId:t.chainId,walletAddress:i,walletType:"inApp",transactionHash:o,contractAddress:t.to??void 0,gasPrice:t.gasPrice}),{transactionHash:o}},async signMessage({message:a}){let i="string"==typeof a?{message:a,isRaw:!1}:{message:"string"==typeof a.raw?a.raw:(0,E.My)(a.raw),isRaw:!0},{signature:n}=await F({client:e,payload:i,storage:t});return n},async signTypedData(a){let i=(0,B.y)(a),{signature:n}=await U({client:e,payload:i,storage:t});return n}}}}var Q=a(46333),_=a(87364);let K={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none",pointerEvents:"all"},G=new Map;class q{constructor({link:e,baseUrl:t,iframeId:a,container:i=document.body,onIframeInitialize:n,localStorage:s,clientId:r,ecosystem:o}){Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.localStorage=s,this.clientId=r,this.ecosystem=o,this.iframeBaseUrl=t;let l=document.getElementById(a),c=new URL(e);if(!l||l.src!==c.href){l=document.createElement("iframe");let e={...K};Object.assign(l.style,e),l.setAttribute("id",a),l.setAttribute("fetchpriority","high"),i.appendChild(l),l.src=c.href;let t=e=>{if("ewsIframeLoaded"===e.data.eventType){if(window.removeEventListener("message",t),!l){console.warn("thirdweb iFrame not found");return}this.onIframeLoadHandler(l,n)()}};window.addEventListener("message",t)}this.iframe=l}async onIframeLoadedInitVariables(){return{authCookie:await this.localStorage.getAuthCookie(),deviceShareStored:await this.localStorage.getDeviceShare(),walletUserId:await this.localStorage.getWalletUserId(),clientId:this.clientId,partnerId:this.ecosystem?.partnerId,ecosystemId:this.ecosystem?.id}}onIframeLoadHandler(e,t){return async()=>{let a=new MessageChannel,i=new Promise((i,n)=>{a.port1.onmessage=s=>{let{data:r}=s;a.port1.close(),r.success||n(Error(r.error)),G.set(e.src,!0),t&&t(),i(!0)}});e?.contentWindow?.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2]),await i}}async call({procedureName:e,params:t,showIframe:a=!1}){for(;!G.get(this.iframe.src);)await (0,_.y)(1e3*this.POLLING_INTERVAL_SECONDS);a&&(this.iframe.style.display="block",await (0,_.y)(5));let i=new MessageChannel,n=new Promise((e,t)=>{i.port1.onmessage=async n=>{let{data:s}=n;i.port1.close(),a&&(await (0,_.y)(100),this.iframe.style.display="none"),s.success?e(s.data):t(Error(s.error))}});return this.iframe.contentWindow?.postMessage({eventType:e,data:{...t,...await this.onIframeLoadedInitVariables()}},this.iframeBaseUrl,[i.port2]),n}destroy(){G.delete(this.iframe.src)}}class R extends q{constructor({clientId:e,baseUrl:t,ecosystem:a}){super({iframeId:V+(a?.id||""),link:function({clientId:e,baseUrl:t,path:a,ecosystem:i,queryParams:n}){let s=new URL(`${a}`,t);if(n)for(let e of Object.keys(n))s.searchParams.set(e,n[e]?.toString()||"");return s.searchParams.set("clientId",e),i?.partnerId!==void 0&&s.searchParams.set("partnerId",i.partnerId),i?.id!==void 0&&s.searchParams.set("ecosystemId",i.id),s}({clientId:e,path:Q.CW,ecosystem:a,baseUrl:t}).href,baseUrl:t,container:document.body,localStorage:new y.t({storage:n.n,clientId:e,ecosystem:a}),clientId:e,ecosystem:a}),this.clientId=e,this.ecosystem=a}}let V="thirdweb-in-app-wallet-iframe";async function J({client:e,ecosystem:t,authToken:a}){let n=(0,s.KI)(e,t),r=await n(`${(0,i.Wg)("inAppWallet")}/api/v1/enclave-wallet/generate`,{method:"POST",headers:{"Content-Type":"application/json","x-thirdweb-client-id":e.clientId,Authorization:`Bearer embedded-wallet-token:${a}`}});if(!r.ok)throw Error(`Failed to generate wallet - ${r.status} ${r.statusText}`);let{wallet:o}=await r.json();return o}class H{constructor({baseUrl:e,querier:t,preLogin:a,postLogin:i,client:n,ecosystem:s}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=e,this.LoginQuerier=t,this.preLogin=a,this.postLogin=i,this.client=n,this.ecosystem=s}async sendEmailLoginOtp({email:e}){return await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:e}})}async sendSmsLoginOtp({phoneNumber:e}){return await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:e}})}}class Y extends H{async authenticateWithModal(){return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0})}async loginWithModal(){await this.preLogin();let e=await this.authenticateWithModal();return this.postLogin(e)}async authenticateWithIframe({email:e}){return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:e},showIframe:!0})}async loginWithIframe({email:e}){await this.preLogin();let t=await this.authenticateWithIframe({email:e});return this.postLogin(t)}async authenticateWithCustomJwt({encryptionKey:e,jwt:t}){if(!e||0===e.length)throw Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:e,jwt:t}})}async loginWithCustomJwt({encryptionKey:e,jwt:t}){if(!e||0===e.length)throw Error("Encryption key is required for custom jwt auth");await this.preLogin();let a=await this.authenticateWithCustomJwt({encryptionKey:e,jwt:t});return this.postLogin(a)}async authenticateWithCustomAuthEndpoint({encryptionKey:e,payload:t}){return this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:e,payload:t}})}async loginWithCustomAuthEndpoint({encryptionKey:e,payload:t}){if(!e||0===e.length)throw Error("Encryption key is required for custom auth");await this.preLogin();let a=await this.authenticateWithCustomAuthEndpoint({encryptionKey:e,payload:t});return this.postLogin(a)}async authenticateWithEmailOtp({email:e,otp:t,recoveryCode:a}){return this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:e,otp:t,recoveryCode:a}})}async loginWithEmailOtp({email:e,otp:t,recoveryCode:a}){let i=await this.authenticateWithEmailOtp({email:e,otp:t,recoveryCode:a});return this.postLogin(i)}async authenticateWithSmsOtp({phoneNumber:e,otp:t,recoveryCode:a}){return this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:e,otp:t,recoveryCode:a}})}async loginWithSmsOtp({phoneNumber:e,otp:t,recoveryCode:a}){let i=await this.authenticateWithSmsOtp({phoneNumber:e,otp:t,recoveryCode:a});return this.postLogin(i)}}class X{constructor({client:e,querier:t,onAuthSuccess:a,ecosystem:i,baseUrl:n,localStorage:s}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=i,this.AuthQuerier=t,this.localStorage=s,this.onAuthSuccess=a,this.BaseLogin=new Y({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},ecosystem:i,querier:t,client:e,baseUrl:n})}async preLogin(){await this.logout()}async postLogin({storedToken:e,walletDetails:t}){return e.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(e.cookieString),await this.onAuthSuccess({storedToken:e,walletDetails:t})}async loginWithAuthToken(e,t){await this.preLogin();let a=await r({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});if(!a)throw Error("Cannot login, no user found for auth token");if(a.wallets.length>0&&a.wallets[0]?.type==="enclave")return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:a.wallets[0].address}});if(0===a.wallets.length){let t=await J({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:t.address}})}let i=await this.AuthQuerier.call({procedureName:"loginWithStoredTokenDetails",params:{storedToken:e.storedToken,recoveryCode:t}});return this.postLogin(i)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(e){return this.BaseLogin.loginWithIframe(e)}async authenticateWithIframe(e){return this.BaseLogin.authenticateWithIframe(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async authenticateWithCustomJwt(e){return this.BaseLogin.authenticateWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async authenticateWithCustomAuthEndpoint(e){return this.BaseLogin.authenticateWithCustomAuthEndpoint(e)}async sendEmailLoginOtp({email:e}){return this.BaseLogin.sendEmailLoginOtp({email:e})}async sendSmsLoginOtp({phoneNumber:e}){return this.BaseLogin.sendSmsLoginOtp({phoneNumber:e})}async loginWithEmailOtp(e){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(e)}async authenticateWithEmailOtp(e){return this.BaseLogin.authenticateWithEmailOtp(e)}async loginWithSmsOtp(e){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(e)}async authenticateWithSmsOtp(e){return this.BaseLogin.authenticateWithSmsOtp(e)}async logout(){this.AuthQuerier&&await this.AuthQuerier.call({procedureName:"logout",params:void 0});let e=await this.localStorage.removeAuthCookie(),t=await this.localStorage.removeWalletUserId();return{success:e||t}}}var Z=a(31660);let ee=async e=>{let{client:t,ecosystem:a}=e,i=(0,m.f)({client:t,ecosystem:a,authOption:e.strategy}),n={"Content-Type":"application/json","x-client-id":t.clientId};a?.id&&(n["x-ecosystem-id"]=a.id),a?.partnerId&&(n["x-ecosystem-partner-id"]=a.partnerId);let s=(()=>{switch(e.strategy){case"email":return{email:e.email};case"phone":return{phone:e.phoneNumber}}})(),r=await fetch(i,{method:"POST",headers:n,body:(0,o.A)(s)});if(!r.ok)throw Error("Failed to send verification code");return await r.json()},et=async e=>{let{client:t,ecosystem:a}=e,i=(0,m.K)({authOption:e.strategy,client:e.client,ecosystem:e.ecosystem}),n={"Content-Type":"application/json","x-client-id":t.clientId};a?.id&&(n["x-ecosystem-id"]=a.id),a?.partnerId&&(n["x-ecosystem-partner-id"]=a.partnerId);let s=(()=>{switch(e.strategy){case"email":return{email:e.email,code:e.verificationCode};case"phone":return{phone:e.phoneNumber,code:e.verificationCode}}})(),r=await fetch(i,{method:"POST",headers:n,body:(0,o.A)(s)});if(!r.ok)throw Error("Failed to verify verification code");return await r.json()};class ea{constructor({client:e,ecosystem:t,querier:a,localStorage:i}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.walletManagerQuerier=a,this.localStorage=i}async postWalletSetUp(e){e.deviceShareStored&&await this.localStorage.saveDeviceShare(e.deviceShareStored,e.storedToken.authDetails.userWalletId)}async getUserWalletStatus(){let e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return"Logged In, Wallet Initialized"===e.status?{status:"Logged In, Wallet Initialized",...e.user,account:await this.getAccount()}:"Logged In, New Device"===e.status?{status:"Logged In, New Device",...e.user}:"Logged In, Wallet Uninitialized"===e.status?{status:"Logged In, Wallet Uninitialized",...e.user}:{status:e.status}}async getAccount(){let e=this.walletManagerQuerier,t=this.client,a=this.ecosystem?.partnerId,{address:n}=await e.call({procedureName:"getAddress",params:void 0}),s=async t=>{let n={to:t.to??void 0,data:t.data,value:t.value,gasLimit:t.gas,nonce:t.nonce,chainId:t.chainId};t.maxFeePerGas?(n.accessList=t.accessList,n.maxFeePerGas=t.maxFeePerGas,n.maxPriorityFeePerGas=t.maxPriorityFeePerGas,n.type=2):(n.gasPrice=t.gasPrice,n.type=0);let s=(0,i.JD)().rpc,{signedTransaction:r}=await e.call({procedureName:"signTransaction",params:{transaction:n,chainId:t.chainId,partnerId:a,rpcEndpoint:`https://${t.chainId}.${s}`}});return r};return{address:(0,D.bv)(n),async signTransaction(e){if(!e.chainId)throw Error("chainId required in tx to sign");return s({...e,chainId:e.chainId})},async sendTransaction(e){let a=(0,x.getRpcClient)({client:t,chain:(0,C.Q4)(e.chainId)}),i=await s(e),r=await (0,$.B)(a,i);return(0,O.E)({client:t,chainId:e.chainId,walletAddress:n,walletType:"inApp",transactionHash:r,contractAddress:e.to??void 0,gasPrice:e.gasPrice}),{transactionHash:r}},async signMessage({message:t}){let i="string"==typeof t?t:t.raw instanceof Uint8Array?t.raw:(0,N.IQ)(t.raw),{signedMessage:n}=await e.call({procedureName:"signMessage",params:{message:i,partnerId:a,chainId:1}});return n},async signTypedData(t){let n=(0,B.y)(t);n.types?.EIP712Domain&&(n.types.EIP712Domain=void 0);let s=n.domain,r=s?.chainId,o={...s?.verifyingContract?{verifyingContract:s?.verifyingContract}:{},name:s?.name,version:s?.version};r&&(o.chainId=r);let l=(0,i.JD)().rpc,{signedTypedData:c}=await e.call({procedureName:"signTypedDataV4",params:{domain:o,types:n.types,message:n.message,chainId:Number.parseInt(BigInt(r||1).toString()),partnerId:a,rpcEndpoint:`https://${r}.${l}`}});return c}}}}class ei{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}constructor({client:e,onAuthSuccess:t,ecosystem:a,passkeyDomain:s}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(e.clientId))throw Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");let r=(0,i.Wg)("inAppWallet");this.client=e,this.ecosystem=a,this.passkeyDomain=s,this.storage=new y.t({storage:n.n,clientId:e.clientId,ecosystem:a}),this.querier=new R({clientId:e.clientId,ecosystem:a,baseUrl:r}),this.auth=new X({client:e,querier:this.querier,baseUrl:r,localStorage:this.storage,ecosystem:a,onAuthSuccess:async e=>{if(t?.(e),"sharded"!==e.storedToken.authDetails.walletType||await this.querier.call({procedureName:"migrateFromShardToEnclave",params:{storedToken:e.storedToken}})||console.warn("Failed to migrate from sharded to enclave wallet, continuing with sharded wallet"),this.wallet=await this.initializeWallet(e.storedToken.cookieString),!this.wallet)throw Error("Failed to initialize wallet");let i="deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:void 0;return await this.wallet.postWalletSetUp({storedToken:e.storedToken,deviceShareStored:i}),this.wallet instanceof ea&&await this.querier.call({procedureName:"initIframe",params:{partnerId:a?.partnerId,ecosystemId:a?.id,clientId:this.client.clientId,deviceShareStored:"deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:null,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:"Logged In, Wallet Initialized",authDetails:e.storedToken.authDetails,account:await this.wallet.getAccount(),walletAddress:e.walletDetails.walletAddress}}}})}async initializeWallet(e){let t=await this.storage.getAuthCookie();if(!e&&null===t)throw Error("No auth token provided and no stored auth token found to initialize the wallet");let a=await r({authToken:e||t,client:this.client,ecosystem:this.ecosystem});if(!a)throw Error("Cannot initialize wallet, no user logged in");if(0===a.wallets.length)throw Error("Cannot initialize wallet, this user does not have a wallet generated yet");return a.wallets[0]?.type==="enclave"?new z({client:this.client,ecosystem:this.ecosystem,address:a.wallets[0].address,storage:this.storage}):new ea({client:this.client,ecosystem:this.ecosystem,querier:this.querier,localStorage:this.storage})}async getUser(){if(!this.wallet){let e=await this.storage.getAuthCookie();if(!e)return{status:"Logged Out"};this.wallet=await this.initializeWallet(e)}if(!this.wallet)throw Error("Wallet not initialized");return await this.wallet.getUserWalletStatus()}getAccount(){if(!this.wallet)throw Error("Wallet not initialized");return this.wallet.getAccount()}async preAuthenticate(e){return ee({...e,client:this.client,ecosystem:this.ecosystem})}authenticateWithRedirect(e,t,a){(0,Z.N)({authOption:e,client:this.client,ecosystem:this.ecosystem,redirectUrl:a,mode:t})}async loginWithAuthToken(e,t){return this.auth.loginWithAuthToken(e,t)}async authenticate(e){let t=e.strategy;switch(t){case"email":case"phone":return et({...e,client:this.client,ecosystem:this.ecosystem});case"auth_endpoint":return p({payload:e.payload,client:this.client,ecosystem:this.ecosystem});case"jwt":return v({jwt:e.jwt,client:this.client,ecosystem:this.ecosystem});case"passkey":return this.passkeyAuth(e);case"iframe_email_verification":return this.auth.authenticateWithIframe({email:e.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"github":case"twitch":case"farcaster":case"line":case"x":case"steam":case"coinbase":case"discord":return(0,Z.x)({authOption:t,client:this.client,ecosystem:this.ecosystem,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow});case"guest":return b({client:this.client,ecosystem:this.ecosystem,storage:n.n});case"backend":return w({client:this.client,walletSecret:e.walletSecret,ecosystem:this.ecosystem});case"wallet":return L({ecosystem:this.ecosystem,client:this.client,wallet:e.wallet,chain:e.chain})}}async connect(e){let t=e.strategy;switch(t){case"auth_endpoint":case"jwt":{let t=await this.authenticate(e);return await this.loginWithAuthToken(t,e.encryptionKey)}case"iframe_email_verification":return this.auth.loginWithIframe({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{let t=await this.passkeyAuth(e);return this.loginWithAuthToken(t)}case"backend":case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"github":case"line":case"x":case"guest":case"coinbase":case"twitch":case"steam":case"discord":{let t=await this.authenticate(e);return await this.auth.loginWithAuthToken(t)}default:!function(e,t){throw Error((void 0)??`Invalid param: ${e}`)}(t)}}async logout(){return await this.auth.logout()}async passkeyAuth(e){let{PasskeyWebClient:t}=await Promise.resolve().then(a.bind(a,21648)),{passkeyName:i,storeLastUsedPasskey:n=!0}=e,s=new t,r=this.storage;return"sign-up"===e.type?T({client:this.client,ecosystem:this.ecosystem,username:i,passkeyClient:s,storage:n?r:void 0,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title}}):j({client:this.client,ecosystem:this.ecosystem,passkeyClient:s,storage:n?r:void 0,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title}})}async linkProfile(e){let{storedToken:t}=await this.authenticate(e);return await I({client:e.client,tokenToLink:t.cookieString,storage:this.storage,ecosystem:e.ecosystem||this.ecosystem})}async unlinkProfile(e){return await k({client:this.client,storage:this.storage,ecosystem:this.ecosystem,profileToUnlink:e})}async getProfiles(){return W({client:this.client,ecosystem:this.ecosystem,storage:this.storage})}}}}]);