"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60126],{60126:(e,t,n)=>{n.d(t,{smartAccountSignMessage:()=>R,smartAccountSignTypedData:()=>N});var r=n(95732),a=n(44771);function i({address:e,data:t,signature:n}){return(0,a.concatHex)([(0,r.hd)([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,t,n]),"0x6492649264926492649264926492649264926492649264926492649264926492"])}var s=n(8226),o=n(96139),c=n(78411),u=n(76867),f=n(46772),d=n(69587);function b(e){let t=!0,n="",r=0,a="",i=!1;for(let s=0;s<e.length;s++){let o=e[s];if(["(",")",","].includes(o)&&(t=!0),"("===o&&r++,")"===o&&r--,t){if(0===r){if(" "===o&&["event","function","error",""].includes(a))a="";else if(a+=o,")"===o){i=!0;break}continue}if(" "===o){","!==e[s-1]&&","!==n&&",("!==n&&(n="",t=!1);continue}a+=o,n+=o}}if(!i)throw new c.C("Unable to normalize signature.");return a}function l(e){return f.di(p(e),0,4)}function p(e){return"string"!=typeof e&&"hash"in e&&e.hash?e.hash:u.So(f.sH(b("string"==typeof e?e:o.B(e))))}class y extends c.C{constructor(e,t){super("Found ambiguous types in overloaded ABI Items.",{metaMessages:[`\`${e.type}\` in \`${b(o.B(e.abiItem))}\`, and`,`\`${t.type}\` in \`${b(o.B(t.abiItem))}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.AmbiguityError"})}}class h extends c.C{constructor({name:e,data:t,type:n="item"}){super(`ABI ${n}${e?` with name "${e}"`:t?` with data "${t}"`:""} not found.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.NotFoundError"})}}var g=n(19649);function m(e,t,n){let r=function(e,t,n){let r;let{args:a=[],prepare:i=!0}=n??{},s=f.tf(t,{strict:!1}),o=e.filter(e=>s?"function"===e.type||"error"===e.type?l(e)===f.di(t,0,4):"event"===e.type&&p(e)===t:"name"in e&&e.name===t);if(0===o.length)throw new h({name:t});if(1===o.length)return{...o[0],...i?{hash:p(o[0])}:{}};for(let e of o)if("inputs"in e){if(!a||0===a.length){if(!e.inputs||0===e.inputs.length)return{...e,...i?{hash:p(e)}:{}};continue}if(e.inputs&&0!==e.inputs.length&&e.inputs.length===a.length&&a.every((t,n)=>{let r="inputs"in e&&e.inputs[n];return!!r&&function e(t,n){let r=typeof t,a=n.type;switch(a){case"address":return d.tf(t,{strict:!1});case"bool":return"boolean"===r;case"function":case"string":return"string"===r;default:if("tuple"===a&&"components"in n)return Object.values(n.components).every((n,r)=>e(Object.values(t)[r],n));if(/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(a))return"number"===r||"bigint"===r;if(/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(a))return"string"===r||t instanceof Uint8Array;if(/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(a))return Array.isArray(t)&&t.every(t=>e(t,{...n,type:a.replace(/(\[[0-9]{0,}\])$/,"")}));return!1}}(t,r)})){if(r&&"inputs"in r&&r.inputs){let t=function e(t,n,r){for(let a in t){let i=t[a],s=n[a];if("tuple"===i.type&&"tuple"===s.type&&"components"in i&&"components"in s)return e(i.components,s.components,r[a]);let o=[i.type,s.type];if(o.includes("address")&&o.includes("bytes20")||(o.includes("address")&&o.includes("string")||o.includes("address")&&o.includes("bytes"))&&d.tf(r[a],{strict:!1}))return o}}(e.inputs,r.inputs,a);if(t)throw new y({abiItem:e,type:t[0]},{abiItem:r,type:t[1]})}r=e}}let c=(()=>{if(r)return r;let[e,...t]=o;return{...e,overloads:t}})();if(!c)throw new h({name:t});return{...c,...i?{hash:p(c)}:{}}}(e,t,n);if("function"!==r.type)throw new h({name:t,type:"function"});return r}var w=n(37111);let v=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}];class A extends c.C{constructor(e){super(`Value \`${e}\` is an invalid ERC-6492 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WrappedSignature.InvalidWrappedSignatureError"})}}var C=n(32068),x=n(53047);let E=[{type:"bytes32",name:"hash"},{type:"bytes",name:"signature"}],I=[{type:"bytes4"}];async function S(e){return(0,x.readContract)({contract:e.contract,method:["0x1626ba7e",E,I],params:[e.hash,e.signature]})}var $=n(65403),M=n(9751),D=n(92437),T=n(5042),_=n(10354),j=n(42499);async function B({hash:e,signature:t,address:n,client:r,chain:a,accountFactory:o}){let c;let u=(()=>{if((0,j.q)(t))return t;if("object"==typeof t&&"r"in t&&"s"in t)return w.nj(t);if(t instanceof Uint8Array)return function(e,t){let n={to:"hex"};switch(n.to){case"number":return function(e,t={}){return T.Ro(e,t)}(e,n);case"bigint":return function(e,t={}){return T.Dg(e,t)}(e,n);case"boolean":return function(e,t={}){return T.G4(e,t)}(e,n);case"string":return function(e,t={}){return T.dI(e,t)}(e,n);default:return(0,_.EY)(e,n)}}(t,0);throw Error(`Invalid signature type for signature ${t}: ${typeof t}`)})(),d=await (async()=>!o||function(e){try{return function(e){if("0x6492649264926492649264926492649264926492649264926492649264926492"!==f.di(e,-32))throw new A(e)}(e),!0}catch{return!1}}(u)?u:i({address:o.address,data:o.verificationCalldata,signature:u}))(),b=await (0,D.k)(a),p=!function(e){for(let t of e)if("string"!=typeof t)return!1;return!0}(v)?v:s.U(v);c=b?{to:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",data:function(e,...t){let{overloads:n}=e,r=n?m([e,...n],e.name,{args:t[0]}):e,a=l(r),i=t.length>0?g.lF(r.inputs,t[0]):void 0;return i?f.xW(a,i):a}(m(p,"isValidSig"),[n,e,d])}:{data:function(e,t){let{bytecode:n,args:r}=t;return f.xW(n,e.inputs?.length&&r?.length?g.lF(e.inputs,r):"0x")}(function(e){let t=e.find(e=>"constructor"===e.type);if(!t)throw new h({name:"constructor"});return t}(p),{args:[n,e,d],bytecode:"0x608060405234801561001057600080fd5b5060405161069438038061069483398101604081905261002f9161051e565b600061003c848484610048565b9050806000526001601ff35b60007f64926492649264926492649264926492649264926492649264926492649264926100748361040c565b036101e7576000606080848060200190518101906100929190610577565b60405192955090935091506000906001600160a01b038516906100b69085906105dd565b6000604051808303816000865af19150503d80600081146100f3576040519150601f19603f3d011682016040523d82523d6000602084013e6100f8565b606091505b50509050876001600160a01b03163b60000361016057806101605760405162461bcd60e51b815260206004820152601e60248201527f5369676e617475726556616c696461746f723a206465706c6f796d656e74000060448201526064015b60405180910390fd5b604051630b135d3f60e11b808252906001600160a01b038a1690631626ba7e90610190908b9087906004016105f9565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610633565b6001600160e01b03191614945050505050610405565b6001600160a01b0384163b1561027a57604051630b135d3f60e11b808252906001600160a01b03861690631626ba7e9061022790879087906004016105f9565b602060405180830381865afa158015610244573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102689190610633565b6001600160e01b031916149050610405565b81516041146102df5760405162461bcd60e51b815260206004820152603a602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610157565b6102e7610425565b5060208201516040808401518451859392600091859190811061030c5761030c61065d565b016020015160f81c9050601b811480159061032b57508060ff16601c14155b1561038c5760405162461bcd60e51b815260206004820152603b602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e617475726520762076616c756500000000006064820152608401610157565b60408051600081526020810180835289905260ff83169181019190915260608101849052608081018390526001600160a01b0389169060019060a0016020604051602081039080840390855afa1580156103ea573d6000803e3d6000fd5b505050602060405103516001600160a01b0316149450505050505b9392505050565b600060208251101561041d57600080fd5b508051015190565b60405180606001604052806003906020820280368337509192915050565b6001600160a01b038116811461045857600080fd5b50565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561048c578181015183820152602001610474565b50506000910152565b600082601f8301126104a657600080fd5b81516001600160401b038111156104bf576104bf61045b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156104ed576104ed61045b565b60405281815283820160200185101561050557600080fd5b610516826020830160208701610471565b949350505050565b60008060006060848603121561053357600080fd5b835161053e81610443565b6020850151604086015191945092506001600160401b0381111561056157600080fd5b61056d86828701610495565b9150509250925092565b60008060006060848603121561058c57600080fd5b835161059781610443565b60208501519093506001600160401b038111156105b357600080fd5b6105bf86828701610495565b604086015190935090506001600160401b0381111561056157600080fd5b600082516105ef818460208701610471565b9190910192915050565b828152604060208201526000825180604084015261061e816060850160208701610471565b601f01601f1916919091016060019392505050565b60006020828403121561064557600080fd5b81516001600160e01b03198116811461040557600080fd5b634e487b7160e01b600052603260045260246000fdfe5369676e617475726556616c696461746f72237265636f7665725369676e6572"})};let y=(0,M.getRpcClient)({chain:a,client:r});try{let e=await (0,$.F)(y,c);return(0,_.Nx)(e)}catch{if(await F({hash:e,signature:u,contract:(0,C.getContract)({chain:a,address:n,client:r})}).catch(e=>(console.error("Error verifying EIP-1271 signature",e),!1)))return!0;return!1}}async function F({hash:e,signature:t,contract:n}){try{return await S({hash:e,signature:t,contract:n})==="0x1626ba7e"}catch{return!1}}var O=n(50856),k=n(90249),U=n(30798),H=n(73503),P=n(8193),W=n(29819);async function R({accountContract:e,factoryContract:t,options:n,message:a}){let s;let o=function(e,t){let n="string"==typeof e?(0,U.Af)(e):e.raw instanceof Uint8Array?e.raw:(0,U.ZJ)(e.raw),r=(0,U.Af)(`\x19Ethereum Signed Message:
${n.length}`);return(0,H.S)(T.xW(r,n),void 0)}(a);if(await V({factoryContract:t,accountContract:e,originalMsgHash:o})){let t=(0,r.hd)([{type:"bytes32"}],[o]);s=await n.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:n.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:t}})}else s=await n.personalAccount.signMessage({message:a});if(await (0,k.isContractDeployed)(e)){if(await F({hash:o,signature:s,contract:e}))return s;throw Error("Failed to verify signature")}{let r=(0,W.HM)({factoryContract:t,adminAddress:n.personalAccount.address,accountSalt:n.overrides?.accountSalt,createAccountOverride:n.overrides?.createAccount});if(!r)throw Error("Create account override not provided");let a=await (0,O.encode)(r),c=i({address:t.address,data:a,signature:s});if(await B({hash:o,signature:c,address:e.address,chain:e.chain,client:e.client}))return c;throw Error("Unable to verify ERC-6492 signature after signing.")}}async function N({accountContract:e,factoryContract:t,options:n,typedData:a}){let s;if(a.domain?.verifyingContract?.toLowerCase()===e.address?.toLowerCase())return n.personalAccount.signTypedData(a);let o=function(e){let{domain:t={},message:n,primaryType:a}=e,i={EIP712Domain:P.HQ(t),...e.types};P.tf({domain:t,message:n,primaryType:a,types:i});let s=["0x1901"];if(t&&s.push(P.xy({domain:t,types:i})),"EIP712Domain"!==a){let e=(()=>{let e=function e({data:t,primaryType:n,types:a}){let i=[{type:"bytes32"}],s=[function({primaryType:e,types:t}){let n=(0,_.nj)(function({primaryType:e,types:t}){let n="",r=function e({primaryType:t,types:n},r=new Set){let a=t.match(/^\w*/u),i=a?.[0];if(r.has(i)||void 0===n[i])return r;for(let t of(r.add(i),n[i]))e({primaryType:t.type,types:n},r);return r}({primaryType:e,types:t});for(let a of(r.delete(e),[e,...Array.from(r).sort()])){if(!t[a])throw Error("Invalid types");n+=`${a}(${t[a].map(({name:e,type:t})=>`${t} ${e}`).join(",")})`}return n}({primaryType:e,types:t}));return(0,H.S)(n)}({primaryType:n,types:a})];if(!a[n])throw Error("Invalid types");for(let o of a[n]){let[n,c]=function t({types:n,name:a,type:i,value:s}){if(void 0!==n[i])return[{type:"bytes32"},(0,H.S)(e({data:s,primaryType:i,types:n}))];if("bytes"===i){let e=s.length%2?"0":"";return s=`0x${e+s.slice(2)}`,[{type:"bytes32"},(0,H.S)(s)]}if("string"===i)return[{type:"bytes32"},(0,H.S)((0,_.nj)(s))];if(i.lastIndexOf("]")===i.length-1){let e=i.slice(0,i.lastIndexOf("[")),o=s.map(r=>t({name:a,type:e,types:n,value:r}));return[{type:"bytes32"},(0,H.S)((0,r.hd)(o.map(([e])=>e),o.map(([,e])=>e)))]}return[{type:i},s]}({types:a,name:o.name,type:o.type,value:t[o.name]});i.push(n),s.push(c)}return(0,r.hd)(i,s)}({data:n,primaryType:a,types:i});return(0,H.S)(e)})();s.push(e)}return(0,H.S)(T.xW(...s.map(e=>T.aD(e))))}(a);if(await V({factoryContract:t,accountContract:e,originalMsgHash:o})){let t=(0,r.hd)([{type:"bytes32"}],[o]);s=await n.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:n.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:t}})}else s=await n.personalAccount.signTypedData(a);if(await (0,k.isContractDeployed)(e)){if(await F({hash:o,signature:s,contract:e}))return s;throw Error("Failed to verify signature")}{let r=(0,W.HM)({factoryContract:t,adminAddress:n.personalAccount.address,accountSalt:n.overrides?.accountSalt,createAccountOverride:n.overrides?.createAccount});if(!r)throw Error("Create account override not provided");let a=await (0,O.encode)(r),c=i({address:t.address,data:a,signature:s});if(await B({hash:o,signature:c,address:e.address,chain:e.chain,client:e.client}))return c;throw Error("Unable to verify signature on smart account, please make sure the admin wallet has permissions and the signature is valid.")}}async function V({factoryContract:e,accountContract:t,originalMsgHash:n}){try{let r=await (0,x.readContract)({contract:e,method:"function accountImplementation() public view returns (address)"});return await (0,x.readContract)({contract:(0,C.getContract)({address:r,chain:t.chain,client:t.client}),method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[n]}).then(e=>"0x"!==e).catch(()=>!1)}catch{return!1}}}}]);